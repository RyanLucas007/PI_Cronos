<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cronos - Admin / Publicar Jogos</title>
  <link rel="icon" href="{{url_for('static', filename='img/cronos_logo_neon_transparent-removebg-preview.png')}}">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    crossorigin="anonymous">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/particula.css') }}">
</head>

<body>
  <div class="container-principal">
    <div class="particles" id="particles"></div>

    <header class="header">
      <div class="logo-container">
        <img src="{{ url_for('static', filename='img/cronos_logo_neon_transparent-removebg-preview.png') }}" alt="logo"
          width="50">
        <h1>Cronos</h1>
      </div>

      <!-- Ícone do menu burguer (mobile) -->
      <img
        src="{{ url_for('static', filename='img/1000_F_225221877_9x7repcZzz4ryhvZ4Z5DmlnnCTdTUImT-removebg-preview.png') }}"
        alt="Menu" class="menu-burger-icon" id="burgerBtn">

      <nav class="nav" id="mainNav" aria-label="Navegação principal">
        <a href="{{ url_for('index') }}"><button class="nav-button">Home</button></a>
        <a href="{{ url_for('biblioteca') }}"><button class="nav-button">Biblioteca</button></a>
        <a href="{{ url_for('loja') }}"><button class="nav-button ">Loja</button></a>
        <a href="{{ url_for('suporte') }}"><button class="nav-button">Suporte</button></a>
        {% if session.get('user_role') == 'dev' or session.get('user_role') == 'admin' %}
        <a href="{{ url_for('dev_upload') }}"><button class="nav-button">Dev</button></a>
        {% endif %}
        {% if session.get('user_role') == 'admin' %}
        <a href="{{ url_for('admin_index') }}"><button class="nav-button active">Admin</button></a>
        {% endif %}
      </nav>

      <div class="perfil" role="button" aria-haspopup="true" aria-expanded="false" id="perfilBtn">
        <div class="avatar" aria-hidden="true">
          {% if session.get('user_avatar') %}
          <img src="/{{ session.get('user_avatar') }}" alt="Avatar">
          {% else %}
          <img src="{{ url_for('static', filename='img/default-avatar.png') }}" alt="Avatar">
          {% endif %}
        </div>
        <span>
          {% if session.get('user_id') %}
          {{ session.get('user_nick') or session.get('user_name') }}
          {% else %} PERFIL {% endif %}
        </span>
      </div>

      <div class="profile-menu" id="profileMenu">
        <div class="profile-header">
          <div class="profile-avatar">
            {% if session.get('user_avatar') %}
            <img src="/{{ session.get('user_avatar') }}" alt="Avatar do usuário">
            {% else %}
            <img src="{{ url_for('static', filename='img/default-avatar.png') }}" alt="Avatar padrão">
            {% endif %}
          </div>
          <div class="profile-info">
            <h4>
              {% if session.get('user_id') %}
              {{ session.get('user_nick') or session.get('user_name') }}
              {% else %}
              Usuário Cronos
              {% endif %}
            </h4>
            <p>
              {% if session.get('user_id') %}
              Nível {{ session.get('user_level', 1) }}
              {% else %}
              Nível 1
              {% endif %}
            </p>
          </div>
        </div>
        <div class="profile-actions">
          {% if session.get('user_id') %}
          <a class="profile-action-btn" href="{{ url_for('perfilConfig') }}">Meu Perfil</a>
          <a class="profile-action-btn" href="{{ url_for('perfilConfig') }}">Configurações</a>
          <a class="profile-action-btn" href="{{ url_for('logout', next=request.full_path or request.path) }}">Sair</a>
          <a href="{{ url_for('politicas') }}" class="profile-action-btn">Políticas</a>
          {% else %}
          <a class="profile-action-btn" href="{{ url_for('login') }}">Entrar</a>
          <a class="profile-action-btn" href="{{ url_for('cadastrar') }}">Cadastrar</a>
          <a class="profile-action-btn" href="{{ url_for('perfilConfig') }}">Configurações</a>
          <a href="{{ url_for('politicas') }}" class="profile-action-btn">Políticas</a>
          {% endif %}
        </div>
      </div>
    </header>

    <main>
      <div class="container admin-review-container">
        <div class="admin-review-header">
          <h2>Aprovação de jogos pendentes</h2>
          <p>Jogos que estão no aguardo para serem liberados na loja.</p>
          <a href="{{ url_for('admin_index') }}" class="btn-admin-back">Ir para painel</a>
        </div>

        {% if pendentes %}
        <div class="admin-table-wrapper">
          <table class="admin-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Título</th>
                <th>Categoria</th>
                <th>Preço</th>
                <th>Dev</th>
                <th>Email</th>
                <th>Enviado em</th>
                <th class="text-center">Testar / Download</th>
                <th class="text-center">Aprovação</th>
              </tr>
            </thead>
            <tbody>
              {% for g in pendentes %}
              <tr>
                <td>#{{ g.id }}</td>
                <td>
                  <div class="admin-game-title">{{ g.titulo }}</div>
                </td>
                <td><span class="badge bg-purple">{{ g.categoria }}</span></td>
                <td>R$ {{ '%.2f'|format(g.preco) }}</td>
                <td>{{ g.dev_name or '-' }}</td>
                <td>{{ g.dev_email or '-' }}</td>
                <td>{{ g.created_at }}</td>
                <td class="text-center">
                  {% if g.build_slug %}
                  <div class="admin-inline-actions">
                    <a href="{{ url_for('admin_testar_build', slug=g.build_slug) }}" class="btn-mini">
                      Testar
                    </a>
                    <a href="{{ url_for('admin_download_build', slug=g.build_slug) }}" class="btn-mini btn-mini-ghost">
                      Baixar ZIP
                    </a>
                  </div>
                  {% else %}
                  <span class="admin-warn">Sem build_slug</span>
                  {% endif %}
                </td>
                <td class="text-center">
                  <form method="post" class="admin-actions-form">
                    <input type="hidden" name="jogo_id" value="{{ g.id }}">
                    <button name="action" value="approve" class="btn-approve">
                      Liberar
                    </button>
                    <button name="action" value="reject" class="btn-reject"
                      onclick="return confirm('Rejeitar este jogo?')">
                      Rejeitar
                    </button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="no-results">
          Não há jogos pendentes no momento.
        </div>
        {% endif %}
      </div>
    </main>
  </div>

  <script src="{{ url_for('static', filename='js/admin_publicar_jogos.js')}}"></script>
  <script src="{{ url_for('static', filename='js/particula.js') }}"></script>
</body>

</html>