<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cronos - Main</title>
  <link rel="icon" href="{{url_for('static', filename='img/cronos_logo_neon_transparent-removebg-preview.png')}}">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    crossorigin="anonymous">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/particula.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>

<body>
  <div class="container-principal">
    <div class="particles" id="particles"></div>

    <!-- HEADER PADR√ÉO CRONOS (MESMO DAS OUTRAS P√ÅGINAS) -->
    <header class="header">
      <div class="logo-container">
        <img src="{{ url_for('static', filename='img/cronos_logo_neon_transparent-removebg-preview.png') }}" alt="logo"
          width="50">
        <h1>Cronos</h1>
      </div>

      <!-- √çCONE DO MENU BURGUER (IMAGEM IGUAL √ÄS OUTRAS P√ÅGINAS) -->
      <img
        src="{{ url_for('static', filename='img/1000_F_225221877_9x7repcZzz4ryhvZ4Z5DmlnnCTdTUImT-removebg-preview.png') }}"
        alt="Menu" class="menu-burger-icon" id="burgerBtn">

      <!-- NAV COM ACTIVE DIN√ÇMICO -->
      <nav class="nav" id="mainNav" aria-label="Navega√ß√£o principal">
        <a href="{{ url_for('index') }}">
          <button class="nav-button {% if request.endpoint == 'index' %}active{% endif %}">Home</button>
        </a>
        <a href="{{ url_for('biblioteca') }}">
          <button class="nav-button {% if request.endpoint == 'biblioteca' %}active{% endif %}">
            Biblioteca
          </button>
        </a>
        <a href="{{ url_for('loja') }}">
          <button class="nav-button {% if request.endpoint == 'loja' %}active{% endif %}">
            Loja
          </button>
        </a>
        <a href="{{ url_for('suporte') }}">
          <button class="nav-button {% if request.endpoint == 'suporte' %}active{% endif %}">
            Suporte
          </button>
        </a>
        {% if session.get('user_role') == 'dev' or session.get('user_role') == 'admin' %}
        <a href="{{ url_for('dev_upload') }}">
          <button class="nav-button {% if request.endpoint == 'dev_upload' %}active{% endif %}">
            Dev
          </button>
        </a>
        {% endif %}
        {% if session.get('user_role') == 'admin' %}
        <a href="{{ url_for('admin_index') }}">
          <button
            class="nav-button {% if request.endpoint and request.endpoint.startswith('admin_') %}active{% endif %}">
            Admin
          </button>
        </a>
        {% endif %}
      </nav>

      <div class="perfil" role="button" aria-haspopup="true" aria-expanded="false" id="perfilBtn">
        <div class="avatar" aria-hidden="true">
          {% if session.get('user_avatar') %}
          <img src="/{{ session.get('user_avatar') }}" alt="Avatar">
          {% else %}
          <img src="{{ url_for('static', filename='img/default-avatar.png') }}" alt="Avatar">
          {% endif %}
        </div>
        <span>
          {% if session.get('user_id') %}
          {{ session.get('user_nick') or session.get('user_name') }}
          {% else %} PERFIL {% endif %}
        </span>
      </div>

      <div class="profile-menu" id="profileMenu">
        <div class="profile-header">
          <div class="profile-avatar">
            {% if session.get('user_avatar') %}
            <img src="/{{ session.get('user_avatar') }}" alt="Avatar do usu√°rio">
            {% else %}
            <img src="{{ url_for('static', filename='img/default-avatar.png') }}" alt="Avatar padr√£o">
            {% endif %}
          </div>
          <div class="profile-info">
            <h4>
              {% if session.get('user_id') %}
              {{ session.get('user_nick') or session.get('user_name') }}
              {% else %}
              Usu√°rio Cronos
              {% endif %}
            </h4>
            <p>
              {% if session.get('user_id') %}
              N√≠vel {{ session.get('user_level', 1) }}
              {% else %}
              N√≠vel 1
              {% endif %}
            </p>
          </div>
        </div>
        <div class="profile-actions">
          {% if session.get('user_id') %}
          <a class="profile-action-btn" href="{{ url_for('perfilConfig') }}">Meu Perfil</a>
          <a class="profile-action-btn" href="{{ url_for('perfilConfig') }}">Configura√ß√µes</a>
          <a class="profile-action-btn" href="{{ url_for('logout', next=request.full_path or request.path) }}">Sair</a>
          <a href="{{ url_for('politicas') }}" class="profile-action-btn">Pol√≠ticas</a>
          {% else %}
          <a class="profile-action-btn" href="{{ url_for('login') }}">Entrar</a>
          <a class="profile-action-btn" href="{{ url_for('cadastrar') }}">Cadastrar</a>
          <a class="profile-action-btn" href="{{ url_for('perfilConfig') }}">Configura√ß√µes</a>
          <a href="{{ url_for('politicas') }}" class="profile-action-btn">Pol√≠ticas</a>
          {% endif %}
        </div>
      </div>
    </header>

    <!-- HERO / CAROUSEL -->
    <section class="hero">
      {% if recentes and recentes|length > 0 %}
      <div id="carouselRecentes" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          {% for g in recentes %}
          <div class="carousel-item {% if loop.index==1 %}active{% endif %}">
            <img src="{{ g.capa_url }}" class="d-block w-100" alt="{{ g.titulo }}">
            <div class="carousel-caption">
              <h2>{{ g.titulo }}</h2>
              <p>{{ (g.descricao or '')[:120] ~ ('‚Ä¶' if (g.descricao and g.descricao|length>120) else '') }}</p>
              <div class="carousel-cta">
                {% if g.build_slug %}
                <a class="btn btn-cta" href="{{ url_for('loja') }}">Ir para a loja</a>
                {% endif %}
                <button class="btn btn-ghost open-modal" data-id="{{ g.id }}" data-title="{{ g.titulo }}"
                  data-desc="{{ g.descricao or '' }}" data-cover="{{ g.capa_url }}"
                  data-trailer="{{ g.trailer_url or '' }}" data-price="{{ '%.2f'|format(g.preco) }}"
                  data-buildslug="{{ g.build_slug or '' }}" data-dev="{{ g.dev_nick or g.dev_name or '' }}"
                  data-published="{{ g.created_at or '' }}" data-reviews="{{ g.reviews or 0 }}">Detalhes</button>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselRecentes" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Anterior</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselRecentes" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Pr√≥ximo</span>
        </button>
      </div>
      {% else %}
      <div class="carousel-fallback">
        <h2>Descubra novos indies na Cronos</h2>
        <p>Quando os criadores enviarem novos builds, eles aparecem aqui primeiro.</p>
      </div>
      {% endif %}
    </section>

    <!-- CONTE√öDO PRINCIPAL -->
    <main class="main-content">
      {% if spotlight %}
      <section class="spotlight-block">
        <div class="spotlight-left">
          <div class="spotlight-dev">
            <img class="spotlight-avatar"
              src="{{ spotlight.dev_avatar or url_for('static', filename='img/default-avatar.png') }}"
              alt="{{ spotlight.dev_name }}">
            <div>
              <div class="spotlight-devname">{{ spotlight.dev_name }}</div>
              <button class="follow-dev" data-dev-id="{{ spotlight.dev_id }}">Seguir criador</button>
            </div>
          </div>
          <h3 class="spotlight-title">{{ spotlight.titulo or spotlight.title }}</h3>
          <p class="spotlight-desc">
            {{ (spotlight.descricao or '')[:220] ~ ('‚Ä¶' if (spotlight.descricao and spotlight.descricao|length>220) else
            '') }}
          </p>
          <div class="spotlight-ctas">
            {% if spotlight.build_slug %}
            <a class="btn btn-cta" href="{{ url_for('loja') }}">Ir para a loja</a>
            {% endif %}
            <button class="btn btn-ghost open-modal" data-id="{{ spotlight.jogo_id or 0 }}"
              data-title="{{ spotlight.titulo or spotlight.title }}" data-desc="{{ spotlight.descricao or '' }}"
              data-cover="{{ spotlight.capa_url or '' }}" data-trailer="{{ spotlight.trailer_url or '' }}"
              data-price="{{ '%.2f'|format(spotlight.preco or 0) }}" data-buildslug="{{ spotlight.build_slug or '' }}"
              data-dev="{{ spotlight.dev_name or '' }}" data-published="{{ spotlight.created_at or '' }}"
              data-reviews="{{ spotlight.reviews or 0 }}">Detalhes</button>
          </div>
        </div>
        <div class="spotlight-right">
          <img src="{{ spotlight.capa_url or '' }}" alt="{{ spotlight.titulo or spotlight.title }}">
          {% if (spotlight.preco or 0) <= 0 %}<span class="ribbon ribbon-free">GR√ÅTIS</span>{% endif %}
            {% if spotlight.build_slug %}<span class="ribbon ribbon-web">WEB</span>{% endif %}
        </div>
      </section>
      {% endif %}

      {% if recentes and recentes|length > 0 %}
      <section class="games-section">
        <h2>‚ú® Rec√©m-adicionados (Indies)</h2>
        <div class="game-grid">
          {% for g in recentes %}
          <article class="indie-card" data-id="{{ g.id }}" data-title="{{ g.titulo }}"
            data-desc="{{ g.descricao or '' }}" data-cover="{{ g.capa_url }}" data-trailer="{{ g.trailer_url or '' }}"
            data-price="{{ '%.2f'|format(g.preco) }}" data-buildslug="{{ g.build_slug or '' }}"
            data-dev="{{ g.dev_nick or g.dev_name or '' }}" data-published="{{ g.created_at or '' }}"
            data-reviews="{{ g.reviews or 0 }}">
            <div class="media-wrap">
              <img src="{{ g.capa_url }}" alt="{{ g.titulo }}">
              <div class="badges">
                {% if (g.preco or 0) <= 0 %}<span class="badge">Gr√°tis</span>{% endif %}
                  {% if g.build_slug %}<span class="badge">Web</span>{% endif %}
                  <span class="badge badge-new">Novo</span>
              </div>
            </div>
            <div class="info">
              <h3>{{ g.titulo }}</h3>
              <p class="cat">{{ g.categoria }}</p>
              <div class="actions">
                {% if g.build_slug %}<a class="btn btn-cta" href="{{ url_for('loja') }}">Ir para a loja</a>{% endif %}
                <button class="btn btn-ghost open-modal">Detalhes</button>
              </div>
            </div>
          </article>
          {% endfor %}
        </div>
      </section>
      {% endif %}

      {% if em_alta and em_alta|length > 0 %}
      <section class="games-section">
        <h2>üî• Em alta (√∫ltimos 30 dias)</h2>
        <div class="game-grid">
          {% for g in em_alta %}
          <article class="indie-card" data-id="{{ g.id }}" data-title="{{ g.titulo }}"
            data-desc="{{ g.descricao or '' }}" data-cover="{{ g.capa_url }}" data-trailer="{{ g.trailer_url or '' }}"
            data-price="{{ '%.2f'|format(g.preco) }}" data-buildslug="{{ g.build_slug or '' }}"
            data-dev="{{ g.dev_nick or g.dev_name or '' }}" data-published="{{ g.created_at or '' }}"
            data-reviews="{{ g.reviews or 0 }}">
            <div class="media-wrap">
              <img src="{{ g.capa_url }}" alt="{{ g.titulo }}">
              <div class="badges">
                {% if (g.preco or 0) <= 0 %}<span class="badge">Gr√°tis</span>{% endif %}
                  {% if g.build_slug %}<span class="badge">Web</span>{% endif %}
                  <span class="badge badge-hot">Trend</span>
              </div>
            </div>
            <div class="info">
              <h3>{{ g.titulo }}</h3>
              <p class="cat">{{ g.categoria }}</p>
              <div class="actions">
                {% if g.build_slug %}<a class="btn btn-cta" href="{{ url_for('loja') }}">Ir para a loja</a>{% endif %}
                <button class="btn btn-ghost open-modal">Detalhes</button>
              </div>
            </div>
          </article>
          {% endfor %}
        </div>
      </section>
      {% endif %}

      {% if descobertas and descobertas|length > 0 %}
      <section class="games-section">
        <h2>üîç Descobertas para voc√™</h2>
        <div class="game-grid">
          {% for g in descobertas %}
          <article class="indie-card" data-id="{{ g.id }}" data-title="{{ g.titulo }}"
            data-desc="{{ g.descricao or '' }}" data-cover="{{ g.capa_url }}" data-trailer="{{ g.trailer_url or '' }}"
            data-price="{{ '%.2f'|format(g.preco) }}" data-buildslug="{{ g.build_slug or '' }}"
            data-dev="{{ g.dev_name or g.dev_nick or '' }}" data-published="{{ g.created_at or '' }}"
            data-reviews="{{ g.reviews or 0 }}">
            <div class="media-wrap">
              <img src="{{ g.capa_url }}" alt="{{ g.titulo }}">
              <div class="badges">
                {% if (g.preco or 0) <= 0 %}<span class="badge">Gr√°tis</span>{% endif %}
                  {% if g.build_slug %}<span class="badge">Web</span>{% endif %}
              </div>
            </div>
            <div class="info">
              <h3>{{ g.titulo }}</h3>
              <p class="cat">{{ g.categoria }}</p>
              <div class="actions">
                {% if g.build_slug %}<a class="btn btn-cta" href="{{ url_for('loja') }}">Ir para a loja</a>{% endif %}
                <button class="btn btn-ghost open-modal">Detalhes</button>
              </div>
            </div>
          </article>
          {% endfor %}
        </div>
      </section>
      {% endif %}

      <!-- MODAL SIMPLES (Acho que voc√™ usa pouco, mantive) -->
      <div class="modal fade" id="gameModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content modal-dark">
            <div class="modal-header">
              <h5 class="modal-title" id="gmTitle">‚Äî</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
              <div class="gm-media">
                <img id="gmCover" src="" alt="" />
                <div class="gm-trailer-wrap"><video id="gmVideo" playsinline loop muted></video></div>
              </div>
              <p id="gmDesc" class="mt-3"></p>
            </div>
            <div class="modal-footer">
              <a id="gmPlay" class="btn btn-cta d-none" href="#">Ir para a loja</a>
              <button class="btn btn-ghost" data-bs-dismiss="modal">Fechar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- MODAL GRANDE (GALERIA + DETALHES) -->
      <div id="gameDetailsModal" class="gmodal" aria-hidden="true" role="dialog" aria-labelledby="gmodalTitle">
        <div class="gmodal__overlay" data-close></div>
        <div class="gmodal__dialog">
          <button class="gmodal__close" aria-label="Fechar" data-close>X</button>
          <div class="gmodal__media" id="gmodalMedia">
            <div class="gmodal__stage" id="gmodalStage">
              <button class="gmodal__nav gmodal__nav--prev" data-nav="prev" aria-label="Anterior">‚Äπ</button>
              <button class="gmodal__nav gmodal__nav--next" data-nav="next" aria-label="Pr√≥ximo">‚Ä∫</button>
            </div>
            <div class="gmodal__rail">
              <div class="gmodal__thumbs" id="gmodalThumbs"></div>
            </div>
          </div>
          <div class="gmodal__body">
            <div class="gmodal__thumbwrap">
              <img id="gmodalSmallCover" alt="Capa do jogo">
            </div>
            <div class="gmodal__header">
              <h3 id="gmodalTitle">-</h3>
              <div class="gmodal__tags" id="gmodalTags"></div>
            </div>
            <p id="gmodalDesc" class="gmodal__desc">-</p>
            <div class="gmodal__meta" id="gmodalMeta">
              <span id="gmodalDate">‚Äî</span>
              <span class="meta-sep">‚Ä¢</span>
              <span id="gmodalDev">‚Äî</span>
              <span class="meta-sep">‚Ä¢</span>
              <span id="gmodalReviews">0 an√°lises</span>
            </div>
            <div class="gmodal__actions">
              <a id="gmodalPlay" class="btn btn-cta" href="#" hidden>Ir para a loja</a>
              <button id="gmodalBuy" class="btn btn-cta" type="button" hidden>Comprar</button>
              <button id="gmodalWishlist" class="btn btn-ghost" type="button">Wishlist</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Scripts base -->
  <script src="{{ url_for('static', filename='js/particula.js') }}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    crossorigin="anonymous"></script>
  <script src="{{ url_for('static', filename='js/index.js') }}"></script>
</body>

</html>