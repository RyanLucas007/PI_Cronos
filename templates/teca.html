<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cronos - Biblioteca</title>
  <link rel="icon" href="{{url_for('static', filename='img/cronos_logo_neon_transparent-removebg-preview.png')}}">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/biblioteca.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/particula.css') }}" />
</head>

<body>
  <div class="container-principal">
    <div class="particles" id="particles"></div>

    <header class="header">
      <div class="logo-container">
        <img src="{{ url_for('static', filename='img/cronos_logo_neon_transparent-removebg-preview.png') }}"
             alt="logo" width="50">
        <h1>Cronos</h1>
      </div>

      <!-- √çcone burger (mobile) -->
      <img
        src="{{ url_for('static', filename='img/1000_F_225221877_9x7repcZzz4ryhvZ4Z5DmlnnCTdTUImT-removebg-preview.png') }}"
        alt="Menu" class="menu-burger-icon" id="burgerBtn">

      <nav class="nav" id="mainNav" aria-label="Navega√ß√£o principal">
        <a href="{{ url_for('index') }}"><button class="nav-button">Home</button></a>
        <a href="{{ url_for('biblioteca') }}"><button class="nav-button active">Biblioteca</button></a>
        <a href="{{ url_for('loja') }}"><button class="nav-button ">Loja</button></a>
        <a href="{{ url_for('suporte') }}"><button class="nav-button">Suporte</button></a>
        {% if session.get('user_role') == 'dev' or session.get('user_role') == 'admin' %}
        <a href="{{ url_for('dev_upload') }}"><button class="nav-button">Dev</button></a>
        {% endif %}
        {% if session.get('user_role') == 'admin' %}
        <a href="{{ url_for('admin_index') }}"><button class="nav-button">Admin</button></a>
        {% endif %}
      </nav>

      <div class="perfil" role="button" aria-haspopup="true" aria-expanded="false" id="perfilBtn">
        <div class="avatar" aria-hidden="true">
          {% if session.get('user_avatar') %}
          <img src="/{{ session.get('user_avatar') }}" alt="Avatar">
          {% else %}
          <img src="{{ url_for('static', filename='img/default-avatar.png') }}" alt="Avatar">
          {% endif %}
        </div>
        <span>
          {% if session.get('user_id') %}
          {{ session.get('user_nick') or session.get('user_name') }}
          {% else %} PERFIL {% endif %}
        </span>
      </div>

      <div class="profile-menu" id="profileMenu">
        <div class="profile-header">
          <div class="profile-avatar">
            {% if session.get('user_avatar') %}
            <img src="/{{ session.get('user_avatar') }}" alt="Avatar do usu√°rio">
            {% else %}
            <img src="{{ url_for('static', filename='img/default-avatar.png') }}" alt="Avatar padr√£o">
            {% endif %}
          </div>
          <div class="profile-info">
            <h4>
              {% if session.get('user_id') %}
              {{ session.get('user_nick') or session.get('user_name') }}
              {% else %}
              Usu√°rio Cronos
              {% endif %}
            </h4>
            <p>
              {% if session.get('user_id') %}
              N√≠vel {{ session.get('user_level', 1) }}
              {% else %}
              N√≠vel 1
              {% endif %}
            </p>
          </div>
        </div>
        <div class="profile-actions">
          {% if session.get('user_id') %}
          <a class="profile-action-btn" href="{{ url_for('perfilConfig') }}">Meu Perfil</a>
          <a class="profile-action-btn" href="{{ url_for('perfilConfig') }}">Configura√ß√µes</a>
          <a class="profile-action-btn"
             href="{{ url_for('logout', next=request.full_path or request.path) }}">Sair</a>
          <a href="{{ url_for('politicas') }}" class="profile-action-btn">Pol√≠ticas</a>
          {% else %}
          <a class="profile-action-btn" href="{{ url_for('login') }}">Entrar</a>
          <a class="profile-action-btn" href="{{ url_for('cadastrar') }}">Cadastrar</a>
          <a class="profile-action-btn" href="{{ url_for('perfilConfig') }}">Configura√ß√µes</a>
          <a href="{{ url_for('politicas') }}" class="profile-action-btn">Pol√≠ticas</a>
          {% endif %}
        </div>
      </div>
    </header>

    <div class="content-wrapper">
      <aside class="leaderboard-container slide-up">
        <h4>Mais Jogados</h4>
        <div class="leaderboard-item">
          <span class="rank">1</span>
          <img src="https://via.placeholder.com/50" alt="Capa do Jogo Cyber Nexus" class="game-cover">
          <div class="game-info">
            <span class="game-title">Cyber Nexus</span>
            <span class="player-count">250k jogando</span>
          </div>
          <div class="game-rating" data-rating="4.5"></div>
        </div>
        <div class="leaderboard-item">
          <span class="rank">2</span>
          <img src="https://via.placeholder.com/50" alt="Capa do Jogo Shadow Legends" class="game-cover">
          <div class="game-info">
            <span class="game-title">Shadow Legends</span>
            <span class="player-count">180k jogando</span>
          </div>
          <div class="game-rating" data-rating="4.2"></div>
        </div>
        <div class="leaderboard-item">
          <span class="rank">3</span>
          <img src="https://via.placeholder.com/50" alt="Capa do Jogo Eternal Quest" class="game-cover">
          <div class="game-info">
            <span class="game-title">Eternal Quest</span>
            <span class="player-count">150k jogando</span>
          </div>
          <div class="game-rating" data-rating="4.7"></div>
        </div>
        <div class="leaderboard-item">
          <span class="rank">4</span>
          <img src="https://via.placeholder.com/50" alt="Capa do Jogo Neon Drift" class="game-cover">
          <div class="game-info">
            <span class="game-title">Neon Drift</span>
            <span class="player-count">120k jogando</span>
          </div>
          <div class="game-rating" data-rating="3.9"></div>
        </div>
        <div class="leaderboard-item">
          <span class="rank">5</span>
          <img src="https://via.placeholder.com/50" alt="Capa do Jogo Astral Conquest" class="game-cover">
          <div class="game-info">
            <span class="game-title">Astral Conquest</span>
            <span class="player-count">95k jogando</span>
          </div>
          <div class="game-rating" data-rating="4.0"></div>
        </div>
      </aside>

      <main class="main">
        <section class="library-controls">
          <h2 class="visually-hidden">Controles da Biblioteca</h2>

          <div class="filter-section">
            <label for="searchInput">Buscar jogo:</label>
            <input id="searchInput" class="form-input" type="text" placeholder="Digite para filtrar por t√≠tulo..." />
          </div>

          <div class="filter-section">
            <label for="categoryFilter">Filtrar por categoria:</label>
            <select id="categoryFilter" class="category-select">
              <option value="all">Todas as categorias</option>
              <option value="a√ß√£o">A√ß√£o</option>
              <option value="aventura">Aventura</option>
              <option value="rpg">RPG</option>
              <option value="fps">FPS</option>
              <option value="estrat√©gia">Estrat√©gia</option>
              <option value="esportes">Esportes</option>
              <option value="simula√ß√£o">Simula√ß√£o</option>
            </select>
          </div>

          <div class="sort-section">
            <label for="sortBy">Ordenar por:</label>
            <select id="sortBy" class="sort-select">
              <option value="alphabetical">Ordem alfab√©tica</option>
              <option value="recent">Mais recentes</option>
              <option value="rating">Melhor avalia√ß√£o</option>
            </select>
          </div>

          <div class="sort-section">
            <label>Exibi√ß√£o:</label>
            <div class="btn-group" role="group" aria-label="Troca de exibi√ß√£o">
              <button id="viewCards" class="add-note-btn" type="button">Cards</button>
              <button id="viewList" class="add-note-btn" type="button">Lista</button>
            </div>
          </div>

          <button class="add-note-btn" id="addNoteBtn">+ Adicionar Anota√ß√£o</button>
        </section>

        <section class="destaque-colecao">
          <h3>SUA BIBLIOTECA</h3>

          {% if not games or games|length == 0 %}
          <div class="alert alert-info" role="alert" style="max-width:720px;">
            Voc√™ ainda n√£o possui jogos. <a href="{{ url_for('loja') }}">Ir para a Loja</a>
          </div>
          {% else %}
          <div id="libraryRow" class="row row-cols-1 row-cols-md-3 g-4">
            {% for g in games %}
            <div class="col">
              <div class="card h-100 shadow-sm lib-item"
                   data-title="{{ g.titulo|lower }}"
                   data-category="{{ g.categoria|lower }}">
                <img src="{{ g.capa_url }}" class="card-img-top" alt="{{ g.titulo }}">
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title">{{ g.titulo }}</h5>
                  <p class="card-text">
                    <span class="badge bg-secondary">{{ g.categoria }}</span>
                  </p>
                  <div class="mt-auto">
                    {% if g.build_slug %}
                    <div class="download-area mt-0"
                         data-game-id="{{ g.id }}"
                         data-title="{{ g.titulo }}"
                         data-slug="{{ g.build_slug }}"
                         data-play-url="{{ url_for('play_build', slug=g.build_slug) }}">
                      <button class="btn btn-primary w-100 btn-download">Baixar</button>
                      <div class="progress dl-progress d-none mt-2" aria-hidden="true">
                        <div class="progress-bar dl-progress-bar" role="progressbar" style="width:0%">0%</div>
                      </div>
                      <div class="play-slot"></div>
                    </div>
                    {% else %}
                    <button class="btn btn-secondary w-100" disabled>Sem build</button>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          {% endif %}
        </section>

        <section class="destaque-grande fade-in">
          <div class="destaque-content">
            <h2>DESTAQUE PRINCIPAL</h2>
            <p class="destaque-desc">
              Experimente o mais novo RPG de a√ß√£o em mundo aberto com gr√°ficos revolucion√°rios
              e uma hist√≥ria cativante.
            </p>
            <button class="destaque-btn">JOGAR AGORA</button>
          </div>
        </section>

        <section class="destaques-pequenos-container">
          <div class="destaque-pequeno slide-up" style="animation-delay: 0.1s" data-category="action">
            <h3>A√ß√£o</h3>
            <span class="game-count">42 jogos</span>
          </div>
          <div class="destaque-pequeno slide-up" style="animation-delay: 0.2s" data-category="adventure">
            <h3>Aventura</h3>
            <span class="game-count">28 jogos</span>
          </div>
          <div class="destaque-pequeno slide-up" style="animation-delay: 0.3s" data-category="rpg">
            <h3>RPG</h3>
            <span class="game-count">35 jogos</span>
          </div>
          <div class="destaque-pequeno slide-up" style="animation-delay: 0.4s" data-category="fps">
            <h3>FPS</h3>
            <span class="game-count">24 jogos</span>
          </div>
          <div class="destaque-pequeno slide-up" style="animation-delay: 0.5s" data-category="strategy">
            <h3>Estrat√©gia</h3>
            <span class="game-count">19 jogos</span>
          </div>
          <div class="destaque-pequeno slide-up" style="animation-delay: 0.6s" data-category="sports">
            <h3>Esportes</h3>
            <span class="game-count">16 jogos</span>
          </div>
        </section>

        <section class="destaque-colecao">
          <h3>RECOMENDADOS PARA VOC√ä</h3>
          <div class="colecao-grid">
            <div class="colecao-item slide-up" style="animation-delay: 0.1s" data-category="rpg">
              <h4>Game One</h4>
              <div class="game-meta">
                <span class="game-category">RPG</span>
                <div class="user-rating" data-rating="4.5"></div>
              </div>
              <button class="add-note-icon" aria-label="Adicionar nota a Game One">üìù</button>
            </div>
            <div class="colecao-item slide-up" style="animation-delay: 0.2s" data-category="action">
              <h4>Game Two</h4>
              <div class="game-meta">
                <span class="game-category">A√ß√£o</span>
                <div class="user-rating" data-rating="3.8"></div>
              </div>
              <button class="add-note-icon" aria-label="Adicionar nota a Game Two">üìù</button>
            </div>
            <div class="colecao-item slide-up" style="animation-delay: 0.3s" data-category="adventure">
              <h4>Game Three</h4>
              <div class="game-meta">
                <span class="game-category">Aventura</span>
                <div class="user-rating" data-rating="4.2"></div>
              </div>
              <button class="add-note-icon" aria-label="Adicionar nota a Game Three">üìù</button>
            </div>
            <div class="colecao-item slide-up" style="animation-delay: 0.4s" data-category="fps">
              <h4>Game Four</h4>
              <div class="game-meta">
                <span class="game-category">FPS</span>
                <div class="user-rating" data-rating="4.7"></div>
              </div>
              <button class="add-note-icon" aria-label="Adicionar nota a Game Four">üìù</button>
            </div>
            <div class="colecao-item slide-up" style="animation-delay: 0.5s" data-category="strategy">
              <h4>Game Five</h4>
              <div class="game-meta">
                <span class="game-category">Estrat√©gia</span>
                <div class="user-rating" data-rating="4.0"></div>
              </div>
              <button class="add-note-icon" aria-label="Adicionar nota a Game Five">üìù</button>
            </div>
            <div class="colecao-item slide-up" style="animation-delay: 0.6s" data-category="sports">
              <h4>Game Six</h4>
              <div class="game-meta">
                <span class="game-category">Esportes</span>
                <div class="user-rating" data-rating="3.5"></div>
              </div>
              <button class="add-note-icon" aria-label="Adicionar nota a Game Six">üìù</button>
            </div>
          </div>
        </section>

        <section class="destaque-colecao">
          <h3>SEUS JOGOS RECENTES</h3>
          <div class="colecao-grid">
            <div class="colecao-item slide-up" style="animation-delay: 0.1s" data-category="rpg">
              <h4>Recent Game 1</h4>
              <div class="game-meta">
                <span class="game-category">RPG</span>
                <div class="user-rating" data-rating="4.5"></div>
              </div>
              <button class="add-note-icon" aria-label="Adicionar nota a Recent Game 1">üìù</button>
            </div>
            <div class="colecao-item slide-up" style="animation-delay: 0.2s" data-category="action">
              <h4>Recent Game 2</h4>
              <div class="game-meta">
                <span class="game-category">A√ß√£o</span>
                <div class="user-rating" data-rating="4.8"></div>
              </div>
              <button class="add-note-icon" aria-label="Adicionar nota a Recent Game 2">üìù</button>
            </div>
            <div class="colecao-item slide-up" style="animation-delay: 0.3s" data-category="adventure">
              <h4>Recent Game 3</h4>
              <div class="game-meta">
                <span class="game-category">Aventura</span>
                <div class="user-rating" data-rating="4.3"></div>
              </div>
              <button class="add-note-icon" aria-label="Adicionar nota a Recent Game 3">üìù</button>
            </div>
            <div class="colecao-item slide-up" style="animation-delay: 0.4s" data-category="fps">
              <h4>Recent Game 4</h4>
              <div class="game-meta">
                <span class="game-category">FPS</span>
                <div class="user-rating" data-rating="4.1"></div>
              </div>
              <button class="add-note-icon" aria-label="Adicionar nota a Recent Game 4">üìù</button>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- Modal de anota√ß√µes -->
  <div class="modal-overlay" id="noteModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Adicionar Anota√ß√£o</h3>
        <button class="modal-close" id="closeModal" aria-label="Fechar modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="noteGame">Jogo:</label>
          <select id="noteGame" class="form-input">
            <option value="">Selecione um jogo</option>
          </select>
        </div>
        <div class="form-group">
          <label for="noteTitle">T√≠tulo da anota√ß√£o:</label>
          <input type="text" id="noteTitle" class="form-input" placeholder="Ex: Dicas para chef√£o final">
        </div>
        <div class="form-group">
          <label for="noteContent">Conte√∫do:</label>
          <textarea id="noteContent" class="form-input" rows="5"
                    placeholder="Escreva suas anota√ß√µes aqui..."></textarea>
        </div>
        <div class="form-group">
          <label for="noteCategory">Categoria:</label>
          <select id="noteCategory" class="form-input">
            <option value="dica">Dica</option>
            <option value="lembrete">Lembrete</option>
            <option value="progresso">Progresso</option>
            <option value="outro">Outro</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" id="cancelNote">Cancelar</button>
        <button class="modal-btn primary" id="saveNote">Salvar Anota√ß√£o</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
          crossorigin="anonymous"></script>

  <!-- Script principal da biblioteca (downloads, notas, etc.) -->
  <script src="{{ url_for('static', filename='JS/biblioteca.js') }}"></script>
  <script src="{{ url_for('static', filename='js/particula.js') }}"></script>

</body>

</html>
